import React, { useState, useEffect, useRef } from 'react';
import imageCompression from 'browser-image-compression';
import QRCode from 'qrcode.react';
import { PinataSDK } from 'pinata';

// Pinata credentials
const PINATA_API_KEY = 'b1adb65f27feca2b1cdc';
const PINATA_SECRET_API_KEY = 'eyJhbGciOiJIUzI1NiI...';
const pinata = new PinataSDK({
  pinataJwt: PINATA_SECRET_API_KEY,
  pinataGateway: 'https://chocolate-internal-scorpion-907.mypinata.cloud',
});

function UploadService() {
  const [files, setFiles] = useState([]);
  const [loading, setLoading] = useState(false);
  const [galleryJsonUrl, setGalleryJsonUrl] = useState(null);
  const [expirationTime, setExpirationTime] = useState(2);
  const [expirationUnit, setExpirationUnit] = useState('d');
  const [removeMetadata, setRemoveMetadata] = useState(false);
  const [isdelChecked, setIsdelChecked] = useState(false);
  const [comment, setComment] = useState('');
  const [loadingx, setLoadingx] = useState(true);
  const [filesUploaded, setFilesUploaded] = useState(false);
  const [error, setError] = useState('');
  const fileInputRef = useRef(null);

  // Initial loader
  useEffect(() => {
    const timer = setTimeout(() => setLoadingx(false), 3000);
    return () => clearTimeout(timer);
  }, []);
  // Success message timer
  useEffect(() => {
    if (!filesUploaded) return;
    const timer = setTimeout(() => setFilesUploaded(false), 5000);
    return () => clearTimeout(timer);
  }, [filesUploaded]);

  // Custom select logic
  useEffect(() => {
    function closeAllSelect() {
      document.querySelectorAll('.select-items').forEach(el => el.classList.add('select-hide'));
      document.querySelectorAll('.select-selected').forEach(el => el.classList.remove('select-arrow-active'));
    }
    document.querySelectorAll('.custom-select').forEach(selEl => {
      const selected = selEl.querySelector('.select-selected');
      selected.addEventListener('click', e => {
        e.stopPropagation(); closeAllSelect();
        selEl.querySelector('.select-items').classList.toggle('select-hide');
        selected.classList.toggle('select-arrow-active');
      });
    });
    document.addEventListener('click', closeAllSelect);
    return () => document.removeEventListener('click', closeAllSelect);
  }, []);

  const handleFileChange = e => {
    const selected = Array.from(e.target.files);
    setFiles(prev => [...prev, ...selected].slice(0, 10));
  };
  const handleDrop = e => { e.preventDefault(); handleFileChange(e); };
  const handleDragOver = e => e.preventDefault();
  const handleExpirationChange = e => setExpirationTime(e.target.value);
  const handleUnitChange = e => setExpirationUnit(e.target.value);
  const handleCheckboxChange = e => setIsdelChecked(e.target.checked);

  const createGalleryJson = (imageUrls, descrx, idxc) => JSON.stringify({
    title: 'Gallery', timex: isdelChecked ? 1 : 3, description: descrx,
    images: imageUrls.map(url => ({ url })), xec: idxc.map(id => ({ id })),
  }, null, 2);

  const handleUpload = async () => {
    setLoading(true); setError('');
    try {
      const imageUrls = [], idxc = [];
      await Promise.all(files.map(async file => {
        const res = await pinata.upload.file(file);
        imageUrls.push(`https://chocolate-internal-scorpion-907.mypinata.cloud/files/${res.cid}`);
        idxc.push(res.id);
      }));
      const jsonBlob = new Blob([createGalleryJson(imageUrls, comment, idxc)], { type: 'application/json' });
      const jsonFile = new File([jsonBlob], 'gallery.json');
      const jsonRes = await pinata.upload.file(jsonFile);
      setGalleryJsonUrl(jsonRes.cid);
      setFilesUploaded(true);
      setFiles([]);
    } catch {
      setError('Ошибка загрузки');
    } finally {
      setLoading(false);
    }
  };

  const handleCopyUrl = () => {
    const url = `https://upfx.vercel.app/gallery/${galleryJsonUrl}`;
    navigator.clipboard.writeText(url);
    alert('Ссылка скопирована');
  };

  if (loadingx) return <div className="loading">Loading...</div>;

  return (
    <div>
      <header>
            <div class="logo">
                <svg width="115" height="42" viewBox="0 0 115 42" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M94.9447 20.0833C93.6603 20.0833 92.5116 19.805 91.4985 19.2483C90.4854 18.6916 89.6894 17.9014 89.1105 16.8777C88.5316 15.8361 88.2422 14.606 88.2422 13.1873C88.2422 11.7506 88.5316 10.5114 89.1105 9.46984C89.7075 8.42825 90.5125 7.62909 91.5256 7.07238C92.5568 6.51566 93.7146 6.2373 94.999 6.2373C96.2834 6.2373 97.4322 6.51566 98.4452 7.07238C99.4764 7.62909 100.281 8.42825 100.86 9.46984C101.457 10.4935 101.756 11.7147 101.756 13.1334C101.756 14.5701 101.457 15.8092 100.86 16.8508C100.263 17.8924 99.4493 18.6916 98.4181 19.2483C97.387 19.805 96.2292 20.0833 94.9447 20.0833ZM94.9176 18.1708C95.7136 18.1708 96.4643 18.0002 97.1699 17.6589C97.8754 17.2998 98.4452 16.752 98.8794 16.0157C99.3317 15.2615 99.5578 14.3097 99.5578 13.1603C99.5578 11.993 99.3407 11.0412 98.9066 10.3049C98.4724 9.56862 97.9025 9.02986 97.197 8.68865C96.5096 8.32948 95.7678 8.14989 94.9719 8.14989C94.1759 8.14989 93.4342 8.32948 92.7467 8.68865C92.0593 9.02986 91.4985 9.57759 91.0643 10.3319C90.6482 11.0682 90.4402 12.011 90.4402 13.1603C90.4402 14.3276 90.6482 15.2794 91.0643 16.0157C91.4804 16.752 92.0231 17.2998 92.6925 17.6589C93.3799 18.0002 94.1216 18.1708 94.9176 18.1708Z" fill="#F5F4F3"/>
                    <path d="M81.7696 6.42657V2.65527H83.8047V6.42657H87.4138V8.31222H83.8047V15.5585C83.8047 16.3846 83.9766 16.9862 84.3203 17.3633C84.6821 17.7405 85.1344 17.9649 85.6771 18.0368C86.2379 18.1086 86.8168 18.1086 87.4138 18.0368V19.7877C86.7083 19.9494 86.0118 19.9943 85.3243 19.9224C84.655 19.8506 84.049 19.653 83.5063 19.3298C82.9816 18.9886 82.5565 18.5127 82.2309 17.9021C81.9233 17.2915 81.7696 16.5103 81.7696 15.5585V8.31222H79.7344V6.42657H81.7696Z" fill="#F5F4F3"/>
                    <path d="M72.1127 20.0833C70.8283 20.0833 69.6795 19.805 68.6665 19.2483C67.6534 18.6916 66.8574 17.9014 66.2785 16.8777C65.6996 15.8361 65.4102 14.606 65.4102 13.1873C65.4102 11.7506 65.6996 10.5114 66.2785 9.46984C66.8755 8.42825 67.6805 7.62909 68.6936 7.07238C69.7247 6.51566 70.8825 6.2373 72.167 6.2373C73.4514 6.2373 74.6001 6.51566 75.6132 7.07238C76.6444 7.62909 77.4494 8.42825 78.0283 9.46984C78.6253 10.4935 78.9238 11.7147 78.9238 13.1334C78.9238 14.5701 78.6253 15.8092 78.0283 16.8508C77.4313 17.8924 76.6172 18.6916 75.5861 19.2483C74.5549 19.805 73.3971 20.0833 72.1127 20.0833ZM72.0856 18.1708C72.8815 18.1708 73.6323 18.0002 74.3378 17.6589C75.0434 17.2998 75.6132 16.752 76.0474 16.0157C76.4997 15.2615 76.7258 14.3097 76.7258 13.1603C76.7258 11.993 76.5087 11.0412 76.0745 10.3049C75.6404 9.56862 75.0705 9.02986 74.365 8.68865C73.6775 8.32948 72.9358 8.14989 72.1398 8.14989C71.3438 8.14989 70.6021 8.32948 69.9147 8.68865C69.2273 9.02986 68.6665 9.57759 68.2323 10.3319C67.8162 11.0682 67.6082 12.011 67.6082 13.1603C67.6082 14.3276 67.8162 15.2794 68.2323 16.0157C68.6484 16.752 69.1911 17.2998 69.8604 17.6589C70.5479 18.0002 71.2896 18.1708 72.0856 18.1708Z" fill="#F5F4F3"/>
                    <path d="M52.2148 0.5H54.25V8.25809C54.6842 7.61158 55.2721 7.11772 56.0139 6.77651C56.7556 6.41734 57.5877 6.23776 58.5103 6.23776C59.5053 6.23776 60.3918 6.46224 61.1697 6.9112C61.9475 7.36017 62.5536 8.02463 62.9878 8.9046C63.44 9.78457 63.6662 10.88 63.6662 12.191V19.8952H61.4953V12.4335C61.4953 11.0327 61.1968 9.96415 60.5998 9.22785C60.0028 8.47359 59.1345 8.09647 57.9948 8.09647C56.8189 8.09647 55.8963 8.49155 55.2269 9.28173C54.5757 10.0719 54.25 11.2213 54.25 12.7298V19.8952H52.2148V0.5Z" fill="#F5F4F3"/>
                    <path d="M43.8744 10.3057C44.8875 10.3057 45.7106 10.153 46.3438 9.84773C46.9769 9.54244 47.4383 9.11143 47.7277 8.55471C48.0352 7.998 48.189 7.35149 48.189 6.61519C48.189 5.44789 47.8453 4.54098 47.1578 3.89447C46.4885 3.24796 45.394 2.92471 43.8744 2.92471H39.3427V10.3057H43.8744ZM50.3327 6.61519C50.3327 7.35149 50.2061 8.06086 49.9528 8.74328C49.7177 9.40775 49.3378 10.0004 48.8131 10.5212C48.2885 11.042 47.6192 11.455 46.8051 11.7603C45.991 12.0477 45.0141 12.1913 43.8744 12.1913H39.3427V19.8955H37.1719V1.03906H43.8744C45.3578 1.03906 46.5699 1.29048 47.5106 1.79332C48.4694 2.29616 49.1749 2.96961 49.6272 3.81366C50.0976 4.65771 50.3327 5.59155 50.3327 6.61519Z" fill="#F5F4F3"/>
                    <path d="M108 27.8419H109.872L109.981 29.8084C110.343 29.3235 110.777 28.9104 111.283 28.5692C111.808 28.228 112.378 27.9946 112.993 27.8688C113.626 27.7252 114.295 27.7162 115.001 27.8419V29.8622C114.241 29.7186 113.554 29.7186 112.939 29.8622C112.342 30.0059 111.826 30.2753 111.392 30.6704C110.958 31.0655 110.623 31.5683 110.388 32.1789C110.153 32.7715 110.035 33.4629 110.035 34.2531V41.3108H108V27.8419Z" fill="#F5F4F3"/>
                    <path d="M99.7389 41.4994C98.4726 41.4994 97.3419 41.1941 96.347 40.5835C95.3701 39.9729 94.6012 39.1378 94.0404 38.0783C93.4796 37.0187 93.1992 35.8065 93.1992 34.4417C93.1992 33.1307 93.4796 31.9634 94.0404 30.9397C94.6012 29.9161 95.3701 29.1169 96.347 28.5423C97.3239 27.9496 98.4364 27.6533 99.6847 27.6533C100.915 27.6533 102.009 27.9227 102.968 28.4615C103.945 29.0002 104.705 29.7455 105.248 30.6973C105.79 31.6491 106.043 32.7356 106.007 33.9568C106.007 34.1543 105.998 34.3608 105.98 34.5763C105.962 34.7918 105.944 35.0253 105.926 35.2767H95.4244C95.4605 36.1208 95.6686 36.8661 96.0485 37.5126C96.4284 38.1591 96.9259 38.6709 97.5409 39.048C98.1741 39.4072 98.8887 39.5868 99.6847 39.5868C100.734 39.5868 101.62 39.3892 102.344 38.9941C103.086 38.5991 103.619 38.0334 103.945 37.2971L105.709 37.9974C105.166 39.1288 104.379 39.9998 103.348 40.6104C102.317 41.203 101.114 41.4994 99.7389 41.4994ZM103.782 33.5258C103.8 32.7535 103.628 32.0711 103.267 31.4785C102.923 30.8859 102.434 30.4189 101.801 30.0777C101.168 29.7365 100.435 29.5659 99.6033 29.5659C98.8796 29.5659 98.2193 29.7365 97.6224 30.0777C97.0254 30.4189 96.5279 30.8948 96.1299 31.5054C95.75 32.0981 95.5239 32.7715 95.4515 33.5258H103.782Z" fill="#F5F4F3"/>
                    <path d="M81.3555 21.916H83.4178V33.6878H84.666L90.0118 27.8423H92.8882L86.4841 34.5768L92.9153 41.3112H90.0118L84.666 35.4388H83.4178V41.3112H81.3555V21.916Z" fill="#F5F4F3"/>
                    <path d="M67.4219 27.8419H69.2942L69.4028 29.7545C69.837 29.09 70.4068 28.5782 71.1123 28.219C71.8179 27.8419 72.641 27.6533 73.5817 27.6533C74.6129 27.6533 75.5174 27.8778 76.2953 28.3268C77.0732 28.7578 77.6792 29.4133 78.1134 30.2932C78.5476 31.1552 78.7646 32.2417 78.7646 33.5527V41.3108H76.7295V33.7951C76.7295 32.3944 76.4219 31.3348 75.8068 30.6165C75.2098 29.8802 74.3415 29.512 73.2018 29.512C72.0259 29.512 71.1033 29.8981 70.4339 30.6704C69.7827 31.4426 69.4571 32.5829 69.4571 34.0915V41.3108H67.4219V27.8419Z" fill="#F5F4F3"/>
                    <path d="M64.6359 41.3107H62.7907L62.655 39.3712C62.2389 40.0536 61.6781 40.5834 60.9726 40.9605C60.2671 41.3197 59.444 41.4993 58.5032 41.4993C57.454 41.4993 56.5404 41.2838 55.7625 40.8528C54.9846 40.4218 54.3786 39.7753 53.9444 38.9132C53.5284 38.0512 53.3203 36.9647 53.3203 35.6538V27.8418H55.3284V35.4383C55.3284 36.8211 55.6269 37.8716 56.2238 38.59C56.8389 39.2904 57.7163 39.6406 58.856 39.6406C60.0138 39.6406 60.9274 39.2724 61.5967 38.5361C62.2842 37.7819 62.6279 36.6505 62.6279 35.1419V27.8418H64.6359V41.3107Z" fill="#F5F4F3"/>
                    <path d="M48.6777 27.5733C48.6777 26.5855 48.343 25.8043 47.6736 25.2297C47.0224 24.637 46.0455 24.3407 44.743 24.3407H39.3701V30.7789H44.8244C46.0545 30.7789 47.0043 30.4915 47.6736 29.9169C48.343 29.3422 48.6777 28.561 48.6777 27.5733ZM37.1992 41.3116V22.4551H44.9329C46.2716 22.4551 47.3751 22.6796 48.2435 23.1285C49.1118 23.5775 49.754 24.1701 50.1701 24.9064C50.6043 25.6248 50.8214 26.4239 50.8214 27.3039C50.8214 28.1659 50.6586 28.8932 50.3329 29.4859C50.0254 30.0605 49.6003 30.5185 49.0576 30.8597C48.5329 31.2009 47.954 31.4344 47.3209 31.5601V31.7486C48.0807 31.8564 48.7591 32.0988 49.3561 32.4759C49.953 32.8351 50.4234 33.329 50.7671 33.9575C51.1108 34.5861 51.2827 35.3493 51.2827 36.2472C51.2827 37.1811 51.0475 38.0341 50.5772 38.8063C50.1068 39.5786 49.4103 40.1891 48.4877 40.6381C47.5832 41.0871 46.4706 41.3116 45.15 41.3116H37.1992ZM39.3701 39.4259H44.9872C46.2897 39.4259 47.3028 39.1386 48.0264 38.5639C48.7681 37.9713 49.139 37.1272 49.139 36.0317C49.139 34.9363 48.75 34.1012 47.9721 33.5265C47.2123 32.9518 46.1902 32.6645 44.9058 32.6645H39.3701V39.4259Z" fill="#F5F4F3"/>
                    <path d="M11.1552 16.592H2.2405L2.24092 28.6272L12.5543 35.5039L21.9095 28.6528L21.9093 7.37963L12.0985 10.8881L4.85008 8.67972L4.83687 8.67562L4.82385 8.67132L0 7.04297L0.592345 5.31376L5.40339 6.93759L12.0518 8.96307L23.7494 4.78027L23.7496 29.5753L12.6043 37.7373L0.401093 29.6009L0.400267 14.7654H12.9952V27.1604H11.1552V16.592Z" fill="#C4ED31"/>
                </svg>
            </div>
            <button class="btn btn-primary btn-icon active">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M1.6875 5.25C1.6875 4.93934 1.93934 4.6875 2.25 4.6875H15.75C16.0607 4.6875 16.3125 4.93934 16.3125 5.25C16.3125 5.56066 16.0607 5.8125 15.75 5.8125H2.25C1.93934 5.8125 1.6875 5.56066 1.6875 5.25Z" fill="#21252A"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M1.6875 9C1.6875 8.68934 1.93934 8.4375 2.25 8.4375H15.75C16.0607 8.4375 16.3125 8.68934 16.3125 9C16.3125 9.31066 16.0607 9.5625 15.75 9.5625H2.25C1.93934 9.5625 1.6875 9.31066 1.6875 9Z" fill="#21252A"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M1.6875 12.75C1.6875 12.4393 1.93934 12.1875 2.25 12.1875H15.75C16.0607 12.1875 16.3125 12.4393 16.3125 12.75C16.3125 13.0607 16.0607 13.3125 15.75 13.3125H2.25C1.93934 13.3125 1.6875 13.0607 1.6875 12.75Z" fill="#21252A"/>
                </svg>
            </button>
        </header>

      <main>
    <aside>
                <div class="aside-content">
                    <div class="logo">
                        <svg width="230" height="83" viewBox="0 0 230 83" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M189.873 39.4518C187.304 39.4518 185.007 38.8911 182.981 37.7695C180.955 36.648 179.363 35.0562 178.205 32.9941C177.048 30.8958 176.469 28.4176 176.469 25.5596C176.469 22.6653 177.048 20.1691 178.205 18.0708C179.399 15.9725 181.009 14.3626 183.035 13.241C185.097 12.1195 187.413 11.5588 189.981 11.5588C192.55 11.5588 194.847 12.1195 196.873 13.241C198.935 14.3626 200.545 15.9725 201.703 18.0708C202.897 20.1329 203.494 22.593 203.494 25.451C203.494 28.3452 202.897 30.8415 201.703 32.9398C200.509 35.0381 198.881 36.648 196.819 37.7695C194.757 38.8911 192.441 39.4518 189.873 39.4518ZM189.818 35.5989C191.41 35.5989 192.912 35.2552 194.322 34.5678C195.733 33.8443 196.873 32.7408 197.741 31.2576C198.646 29.7381 199.098 27.8207 199.098 25.5053C199.098 23.1537 198.664 21.2363 197.796 19.753C196.927 18.2697 195.788 17.1844 194.377 16.497C193.002 15.7735 191.519 15.4117 189.927 15.4117C188.335 15.4117 186.852 15.7735 185.477 16.497C184.102 17.1844 182.981 18.2878 182.112 19.8073C181.28 21.2906 180.864 23.1899 180.864 25.5053C180.864 27.8568 181.28 29.7743 182.112 31.2576C182.945 32.7408 184.03 33.8443 185.368 34.5678C186.743 35.2552 188.227 35.5989 189.818 35.5989Z" fill="#F5F4F3"/>
                            <path d="M163.525 11.9388V4.34143H167.595V11.9388H174.813V15.7374H167.595V30.3351C167.595 31.9993 167.939 33.2113 168.626 33.971C169.35 34.7307 170.254 35.1829 171.339 35.3277C172.461 35.4724 173.619 35.4724 174.813 35.3277V38.855C173.402 39.1806 172.009 39.271 170.634 39.1263C169.295 38.9816 168.083 38.5837 166.998 37.9325C165.949 37.2451 165.099 36.2864 164.448 35.0563C163.833 33.8263 163.525 32.2526 163.525 30.3351V15.7374H159.455V11.9388H163.525Z" fill="#F5F4F3"/>
                            <path d="M144.214 39.4518C141.646 39.4518 139.348 38.8911 137.323 37.7695C135.297 36.648 133.705 35.0562 132.547 32.9941C131.389 30.8958 130.811 28.4176 130.811 25.5596C130.811 22.6653 131.389 20.1691 132.547 18.0708C133.741 15.9725 135.351 14.3626 137.377 13.241C139.439 12.1195 141.754 11.5588 144.323 11.5588C146.892 11.5588 149.189 12.1195 151.215 13.241C153.277 14.3626 154.887 15.9725 156.045 18.0708C157.238 20.1329 157.835 22.593 157.835 25.451C157.835 28.3452 157.238 30.8415 156.045 32.9398C154.851 35.0381 153.223 36.648 151.161 37.7695C149.098 38.8911 146.783 39.4518 144.214 39.4518ZM144.16 35.5989C145.752 35.5989 147.253 35.2552 148.664 34.5678C150.075 33.8443 151.215 32.7408 152.083 31.2576C152.987 29.7381 153.44 27.8207 153.44 25.5053C153.44 23.1537 153.006 21.2363 152.137 19.753C151.269 18.2697 150.129 17.1844 148.719 16.497C147.344 15.7735 145.86 15.4117 144.269 15.4117C142.677 15.4117 141.194 15.7735 139.819 16.497C138.444 17.1844 137.323 18.2878 136.454 19.8073C135.622 21.2906 135.206 23.1899 135.206 25.5053C135.206 27.8568 135.622 29.7743 136.454 31.2576C137.286 32.7408 138.372 33.8443 139.71 34.5678C141.085 35.2552 142.568 35.5989 144.16 35.5989Z" fill="#F5F4F3"/>
                            <path d="M104.416 3.05176e-05H108.486V15.6288C109.354 14.3264 110.53 13.3315 112.013 12.6441C113.497 11.9206 115.161 11.5588 117.006 11.5588C118.996 11.5588 120.768 12.011 122.324 12.9155C123.88 13.8199 125.092 15.1585 125.96 16.9312C126.864 18.7039 127.317 20.9108 127.317 23.5517V39.072H122.975V24.0401C122.975 21.2183 122.378 19.0657 121.184 17.5824C119.991 16.0629 118.254 15.3032 115.975 15.3032C113.623 15.3032 111.778 16.0991 110.44 17.6909C109.137 19.2828 108.486 21.5981 108.486 24.6371V39.072H104.416V3.05176e-05Z" fill="#F5F4F3"/>
                            <path d="M87.7398 19.753C89.7657 19.753 91.4118 19.4455 92.678 18.8304C93.9443 18.2154 94.8668 17.3472 95.4456 16.2256C96.0607 15.1041 96.3682 13.8017 96.3682 12.3185C96.3682 9.9669 95.6808 8.13993 94.306 6.83753C92.9675 5.53513 90.7787 4.88393 87.7398 4.88393H78.6773V19.753H87.7398ZM100.655 12.3185C100.655 13.8017 100.402 15.2308 99.8955 16.6055C99.4252 17.9441 98.6655 19.138 97.6163 20.1871C96.5672 21.2363 95.2286 22.0683 93.6006 22.6834C91.9726 23.2622 90.019 23.5516 87.7398 23.5516H78.6773V39.0719H74.3359V1.08527H87.7398C90.7064 1.08527 93.1303 1.59176 95.0115 2.60473C96.9289 3.61771 98.3399 4.97437 99.2443 6.67473C100.185 8.37508 100.655 10.2563 100.655 12.3185Z" fill="#F5F4F3"/>
                            <path d="M215.979 55.0819H219.723L219.94 59.0434C220.664 58.0666 221.532 57.2345 222.545 56.5471C223.594 55.8597 224.734 55.3894 225.964 55.1362C227.23 54.8467 228.568 54.8287 229.979 55.0819V59.1519C228.46 58.8625 227.085 58.8625 225.855 59.1519C224.661 59.4413 223.63 59.984 222.762 60.7799C221.894 61.5758 221.224 62.5888 220.754 63.8188C220.284 65.0127 220.049 66.4055 220.049 67.9974V82.2152H215.979V55.0819Z" fill="#F5F4F3"/>
                            <path d="M199.457 82.5951C196.925 82.5951 194.664 81.98 192.674 80.75C190.72 79.52 189.183 77.8377 188.061 75.7032C186.94 73.5687 186.379 71.1267 186.379 68.3772C186.379 65.7362 186.94 63.3847 188.061 61.3226C189.183 59.2604 190.72 57.6505 192.674 56.4928C194.627 55.299 196.852 54.702 199.349 54.702C201.809 54.702 203.997 55.2447 205.915 56.33C207.868 57.4154 209.388 58.9167 210.473 60.8342C211.559 62.7516 212.065 64.9403 211.993 67.4004C211.993 67.7984 211.975 68.2144 211.938 68.6485C211.902 69.0827 211.866 69.553 211.83 70.0595H190.829C190.901 71.7598 191.317 73.2612 192.077 74.5636C192.837 75.866 193.832 76.8971 195.062 77.6568C196.328 78.3804 197.757 78.7421 199.349 78.7421C201.447 78.7421 203.22 78.3442 204.667 77.5483C206.15 76.7524 207.217 75.6128 207.868 74.1295L211.396 75.5404C210.31 77.8196 208.737 79.5742 206.675 80.8043C204.612 81.9981 202.207 82.5951 199.457 82.5951ZM207.543 66.5321C207.579 64.9765 207.235 63.6018 206.512 62.4079C205.824 61.214 204.848 60.2734 203.581 59.586C202.315 58.8986 200.85 58.555 199.186 58.555C197.739 58.555 196.418 58.8986 195.224 59.586C194.03 60.2734 193.036 61.2321 192.24 62.4621C191.48 63.656 191.028 65.0127 190.883 66.5321H207.543Z" fill="#F5F4F3"/>
                            <path d="M162.686 43.1433H166.81V66.8578H169.306L179.997 55.0819H185.749L172.942 68.6486L185.803 82.2152H179.997L169.306 70.3851H166.81V82.2152H162.686V43.1433Z" fill="#F5F4F3"/>
                            <path d="M134.824 55.0819H138.569L138.786 58.9348C139.654 57.5962 140.794 56.5652 142.204 55.8416C143.615 55.0819 145.261 54.702 147.143 54.702C149.205 54.702 151.014 55.1542 152.569 56.0587C154.125 56.927 155.337 58.2474 156.205 60.0202C157.074 61.7567 157.508 63.9454 157.508 66.5864V82.2152H153.438V67.0748C153.438 64.2529 152.823 62.1185 151.593 60.6714C150.399 59.1881 148.662 58.4464 146.383 58.4464C144.031 58.4464 142.186 59.2242 140.848 60.7799C139.545 62.3355 138.894 64.6328 138.894 67.6717V82.2152H134.824V55.0819Z" fill="#F5F4F3"/>
                            <path d="M129.26 82.2151H125.57L125.299 78.3079C124.466 79.6827 123.345 80.7499 121.934 81.5097C120.523 82.2332 118.877 82.595 116.996 82.595C114.897 82.595 113.07 82.1608 111.515 81.2926C109.959 80.4243 108.747 79.1219 107.879 77.3854C107.047 75.6489 106.631 73.4601 106.631 70.8191V55.0818H110.647V70.385C110.647 73.1707 111.244 75.2871 112.437 76.7342C113.667 78.1451 115.422 78.8506 117.701 78.8506C120.017 78.8506 121.844 78.1089 123.182 76.6257C124.557 75.1062 125.244 72.827 125.244 69.7881V55.0818H129.26V82.2151Z" fill="#F5F4F3"/>
                            <path d="M97.3415 54.5392C97.3415 52.5494 96.6722 50.9757 95.3336 49.818C94.0312 48.6241 92.0776 48.0272 89.4728 48.0272H78.728V60.9969H89.6356C92.0957 60.9969 93.9951 60.4181 95.3336 59.2604C96.6722 58.1027 97.3415 56.5289 97.3415 54.5392ZM74.3867 82.2151V44.2285H89.8527C92.5299 44.2285 94.7367 44.6807 96.4732 45.5852C98.2098 46.4896 99.4941 47.6835 100.326 49.1668C101.194 50.6139 101.629 52.2238 101.629 53.9965C101.629 55.733 101.303 57.1982 100.652 58.3921C100.037 59.5498 99.1866 60.4723 98.1012 61.1597C97.0521 61.8471 95.8944 62.3174 94.6282 62.5706V62.9505C96.1476 63.1676 97.5043 63.656 98.6982 64.4157C99.892 65.1392 100.833 66.1341 101.52 67.4004C102.207 68.6666 102.551 70.2041 102.551 72.013C102.551 73.8943 102.081 75.6127 101.14 77.1683C100.2 78.724 98.8067 79.954 96.9616 80.8585C95.1527 81.7629 92.9278 82.2151 90.2868 82.2151H74.3867ZM78.728 78.4165H89.9612C92.566 78.4165 94.592 77.8376 96.0391 76.6799C97.5224 75.4861 98.264 73.7857 98.264 71.5789C98.264 69.372 97.4862 67.6898 95.9306 66.5321C94.4111 65.3744 92.3671 64.7956 89.7984 64.7956H78.728V78.4165Z" fill="#F5F4F3"/>
                            <path d="M22.3084 32.4163H4.48059L4.48142 56.6613L25.1063 70.5145L43.8151 56.713L43.8146 13.8578L24.1947 20.9256L9.69928 16.4769L9.67284 16.4686L9.64682 16.4599L0 13.1796L1.18458 9.69608L10.8058 12.9673L24.1014 17.0477L47.4944 8.62137L47.4948 58.5712L25.2062 75.0137L0.802112 58.6228L0.80046 28.7365H25.9881V53.7065H22.3084V32.4163Z" fill="#C4ED31"/>
                        </svg>
                    </div>
                    <ul class="nav">
                        <li>
                            <a href="#main" class="btn btn-primary active">
                                <svg width="26" height="27" viewBox="0 0 26 27" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M21.7104 7.48301L15.4704 3.11718C13.7696 1.92551 11.1587 1.99051 9.52292 3.25801L4.09542 7.49385C3.01208 8.33885 2.15625 10.0722 2.15625 11.4372V18.9122C2.15625 21.6747 4.39875 23.928 7.16125 23.928H18.8396C21.6021 23.928 23.8446 21.6855 23.8446 18.923V11.578C23.8446 10.1155 22.9021 8.31718 21.7104 7.48301ZM13.8129 19.5947C13.8129 20.0388 13.4446 20.4072 13.0004 20.4072C12.5562 20.4072 12.1879 20.0388 12.1879 19.5947V16.3447C12.1879 15.9005 12.5562 15.5322 13.0004 15.5322C13.4446 15.5322 13.8129 15.9005 13.8129 16.3447V19.5947Z" fill="#F5F4F3"/>
                                </svg>
                                Главная
                            </a>
                        </li>
                        <li>
                            <a href="#service" class="btn btn-primary">
                                <svg width="26" height="27" viewBox="0 0 26 27" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12.1883 4.32006V14.0917C12.1883 14.4492 12.015 14.7742 11.7225 14.9801L3.91163 20.4509C3.27247 20.8951 2.36247 20.5484 2.22163 19.7792C2.05913 18.8476 2.2758 17.7534 2.9258 16.5726L6.3058 10.4951L9.4908 4.76422C9.73997 4.32006 10.0108 3.93006 10.2925 3.59422C10.9425 2.83589 12.1883 3.32339 12.1883 4.32006Z" fill="#F5F4F3"/>
                                    <path d="M22.0892 20.4509L14.2783 14.9801C13.9858 14.7742 13.8125 14.4492 13.8125 14.0917V4.32006C13.8125 3.32339 15.0583 2.83589 15.7083 3.59422C15.99 3.93006 16.2608 4.32006 16.51 4.76422L19.695 10.4951L23.075 16.5726C23.725 17.7534 23.9417 18.8476 23.7792 19.7792C23.6383 20.5484 22.7283 20.8951 22.0892 20.4509Z" fill="#F5F4F3"/>
                                    <path d="M5.69869 20.83L12.3612 16.3883C12.7187 16.15 13.3037 16.15 13.6612 16.3883L20.3237 20.83C22.0895 22.0108 21.797 22.975 19.6737 22.975H6.33786C4.22536 22.9642 3.93286 22 5.69869 20.83Z" fill="#F5F4F3"/>
                                </svg>
                                О сервисе
                            </a>
                        </li>
                        <li>
                            <a href="#ipfs" class="btn btn-primary">
                                <svg width="26" height="27" viewBox="0 0 26 27" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20.9411 6.24836L14.1486 2.58669C13.4336 2.19669 12.567 2.19669 11.852 2.58669L5.05948 6.24836C4.56115 6.51919 4.25781 7.03919 4.25781 7.63502C4.25781 8.22002 4.56115 8.75086 5.05948 9.02169L11.852 12.6834C12.2095 12.8784 12.6103 12.9759 13.0003 12.9759C13.3903 12.9759 13.7911 12.8784 14.1486 12.6834L20.9411 9.02169C21.4395 8.75086 21.7428 8.23086 21.7428 7.63502C21.7428 7.03919 21.4395 6.51919 20.9411 6.24836Z" fill="#F5F4F3"/>
                                    <path d="M10.7352 13.9508L4.40852 10.7875C3.92102 10.5492 3.35768 10.5708 2.90268 10.8525C2.43685 11.145 2.16602 11.6325 2.16602 12.1742V18.1433C2.16602 19.1725 2.74018 20.1042 3.66102 20.57L9.97685 23.7333C10.1935 23.8417 10.4318 23.8958 10.6702 23.8958C10.9518 23.8958 11.2335 23.82 11.4827 23.6683C11.9485 23.3867 12.2193 22.8883 12.2193 22.3467V16.3775C12.2302 15.3375 11.656 14.4058 10.7352 13.9508Z" fill="#F5F4F3"/>
                                    <path d="M23.096 10.8525C22.6301 10.5708 22.0668 10.5383 21.5901 10.7875L15.2743 13.9508C14.3535 14.4167 13.7793 15.3375 13.7793 16.3775V22.3467C13.7793 22.8883 14.0501 23.3867 14.516 23.6683C14.7651 23.82 15.0468 23.8958 15.3285 23.8958C15.5668 23.8958 15.8051 23.8417 16.0218 23.7333L22.3376 20.57C23.2585 20.1042 23.8326 19.1833 23.8326 18.1433V12.1742C23.8326 11.6325 23.5618 11.145 23.096 10.8525Z" fill="#F5F4F3"/>
                                </svg>
                                Почему IPFS
                            </a>
                        </li>
                    </ul>
                    <svg class="bg-img" width="146" height="203" viewBox="0 0 146 203" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g filter="url(#filter0_i_2010_3112)">
                            <path d="M68.623 72.9775H14.3853L14.3878 146.739L77.1351 188.884L134.053 146.896L134.052 16.5169L74.3618 38.0195L30.2622 24.4848L30.1818 24.4597L30.1026 24.4333L0.753906 14.4536L4.35778 3.85556L33.6286 13.8077L74.0779 26.2214L145.247 0.585938L145.248 152.549L77.4392 202.572L3.19418 152.706L3.18916 61.7826H79.8179V137.749H68.623V72.9775Z" fill="#21252A"/>
                        </g>
                        <defs>
                            <filter id="filter0_i_2010_3112" x="0.753906" y="0.585938" width="144.494" height="204.893" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                                <feFlood flood-opacity="0" result="BackgroundImageFix"/>
                                <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
                                <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
                                <feOffset dy="5.8125"/>
                                <feGaussianBlur stdDeviation="1.45313"/>
                                <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1"/>
                                <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.15 0"/>
                                <feBlend mode="normal" in2="shape" result="effect1_innerShadow_2010_3112"/>
                            </filter>
                        </defs>
                    </svg>
                    <a href="#" class="btn btn-primary active">
                        <svg width="26" height="27" viewBox="0 0 26 27" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M18.416 2.72717H7.58268C4.33268 2.72717 2.16602 4.89384 2.16602 8.14384V14.6438C2.16602 17.8938 4.33268 20.0605 7.58268 20.0605V22.368C7.58268 23.2347 8.54685 23.7547 9.26185 23.2672L14.0827 20.0605H18.416C21.666 20.0605 23.8327 17.8938 23.8327 14.6438V8.14384C23.8327 4.89384 21.666 2.72717 18.416 2.72717ZM12.9993 15.9113C12.5443 15.9113 12.1868 15.543 12.1868 15.0988C12.1868 14.6547 12.5443 14.2863 12.9993 14.2863C13.4543 14.2863 13.8118 14.6547 13.8118 15.0988C13.8118 15.543 13.4543 15.9113 12.9993 15.9113ZM14.3643 11.4155C13.9418 11.6972 13.8118 11.8813 13.8118 12.1847V12.4122C13.8118 12.8563 13.4435 13.2247 12.9993 13.2247C12.5552 13.2247 12.1868 12.8563 12.1868 12.4122V12.1847C12.1868 10.928 13.1077 10.3105 13.4543 10.0722C13.8552 9.80134 13.9852 9.61717 13.9852 9.33551C13.9852 8.79384 13.541 8.34967 12.9993 8.34967C12.4577 8.34967 12.0135 8.79384 12.0135 9.33551C12.0135 9.77967 11.6452 10.148 11.201 10.148C10.7568 10.148 10.3885 9.77967 10.3885 9.33551C10.3885 7.89467 11.5585 6.72467 12.9993 6.72467C14.4402 6.72467 15.6102 7.89467 15.6102 9.33551C15.6102 10.5705 14.7002 11.188 14.3643 11.4155Z" fill="#2E323A"/>
                        </svg>
                        Поддержка
                    </a>
                </div>
            </aside>
        {!filesUploaded && (
          <>
            <h1 className="h1">Загрузите файлы в IPFS</h1>
            <div className="upload-form" onDrop={handleDrop} onDragOver={handleDragOver} onClick={() => fileInputRef.current.click()}>
              <input ref={fileInputRef} type="file" multiple onChange={handleFileChange} hidden />
              <p className="caption">Перетащите файлы или кликните для загрузки <span className="hidden-lg">Тапните для загрузки</span></p>
            </div>
            <div className="upload-settings">
              <h2 className="h2">Настройки</h2>
              <div className="custom-select selects-list">
                <div className="select-selected">Время жизни: {expirationTime}{expirationUnit}</div>
                <div className="select-items select-hide">
                  <div onClick={() => { setExpirationUnit('h'); setError(''); }}>Часы</div>
                  <div onClick={() => { setExpirationUnit('d'); setError(''); }}>Дни</div>
                  <div onClick={() => { setExpirationUnit('w'); setError(''); }}>Недели</div>
                  <div onClick={() => { setExpirationUnit('M'); setError(''); }}>Месяцы</div>
                </div>
              </div>
              <div className="settings-inputs">
                <input type="text" value={expirationTime} onChange={handleExpirationChange} />
                {error && <div className="error-msg">{error}</div>}
                <label><input type="checkbox" checked={isdelChecked} onChange={handleCheckboxChange} /> Удалить после просмотра</label>
                <label><input type="checkbox" checked={removeMetadata} onChange={() => setRemoveMetadata(!removeMetadata)} /> Сжать и удалить метаданные</label>
              </div>
              <button className="btn btn-primary" onClick={handleUpload} disabled={loading || files.length === 0}>{loading ? 'Загрузка...' : 'Загрузить файлы'}</button>
            </div>
          </>
        )}

        {files.length > 0 && (
          <div className="files-preview">
            {files.map((file, idx) => (
              <div key={idx} className="file-item">
                <img src={URL.createObjectURL(file)} alt="preview" onClick={() => setFilesUploaded(true)} />
                <span className="file-name">{file.name}</span>
              </div>
            ))}
            <textarea placeholder="Комментарий..." value={comment} onChange={e => setComment(e.target.value)} />
            <div className="comment-hint">* Комментарий будет добавлен ко всем файлам</div>
          </div>
        )}

        {galleryJsonUrl && (
          <div className="gallery-link-block">
            <h1 className="h1">Галерея готова</h1>
            <QRCode value={`https://upfx.vercel.app/gallery/${galleryJsonUrl}`} size={200} />
            <textarea readOnly value={`https://upfx.vercel.app/gallery/${galleryJsonUrl}`} />
            <div className="button-group">
              <button onClick={() => window.open(`/gallery/${galleryJsonUrl}`, '_blank')} className="btn btn-primary">Открыть галерею</button>
              <button onClick={handleCopyUrl} className="btn btn-secondary">Копировать ссылку</button>
            </div>
          </div>
        )}
      </main>

      <section className="features">
        <h2 className="h1">Почему выбрать наш сервис?</h2>
        <div className="feature-list">
          <div className="feature-item">
            <h3 className="h2">Продвинутое Шифрование</h3>
            <p>Криптографическая стойкость SHA-256 обеспечивает защиту...</p>
          </div>
          <div className="feature-item">
            <h3 className="h2">Приватность и Безопасность</h3>
            <p>Мы удаляем метаданные для защиты вашей приватности...</p>
          </div>
          <div className="feature-item">
            <h3 className="h2">Полная Анонимность</h3>
            <p>Мы не храним личные данные и не отслеживаем активность...</p>
          </div>
          <div className="feature-item">
            <h3 className="h2">Распределенное Хранилище</h3>
            <p>Ваши файлы надежно хранятся в сети IPFS...</p>
          </div>
        </div>
      </section>

      <section className="info-sections">
        <h2 className="h1">Почему IPFS?</h2>
        <p>IPFS — это децентрализованная файловая система...</p>
        <h2 className="h1">Удаление Метаданных</h2>
        <p>Файлы очищаются от геолокации, EXIF, и др. для анонимности...</p>
      </section>

      <footer className="footer">
        <div className="footer-top">
          <div className="logo-footer">{/* SVG */}</div>
          <div className="social-footer">{/* Telegram icon */}</div>
        </div>
        <div className="footer-bot">
          <p>X 2024</p><p>All rights reserved</p>
        </div>
      </footer>
    </div>
  );
}

export default UploadService;
